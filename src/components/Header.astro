---
import { Image } from 'astro:assets';
import { NAV_LINKS, NAV_LINKS_MOBILE, CONTACT_SUBMENU, SITE } from '../lib/site';
import logo from '../assets/logo.webp';
const ctaHref = '/request-inspection';
---

<header class="site-header">
  <nav class="site-nav">
    <!-- Mobile Hamburger Menu Button -->
    <button 
      class="mobile-menu-btn" 
      aria-label="Toggle mobile menu"
      aria-expanded="false"
      aria-controls="mobile-menu"
    >
      <span></span>
      <span></span>
      <span></span>
    </button>

    <!-- Logo / Brand -->
    <a href="/" aria-label={`${SITE.name} home`} class="site-logo-link">
      <Image src={logo} alt={SITE.name} class="site-logo" loading="eager" width={280} height={80} />
    </a>

    <!-- Desktop Navigation Links -->
    <div class="site-nav-links">
      {NAV_LINKS.map((l) => (
        l.label === 'Contact' ? (
          <div class="nav-dropdown">
            <a href={l.href} class="nav-dropdown-link">{l.label}</a>
            <button class="nav-dropdown-trigger" aria-label="Open Contact submenu">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="6 9 10 13 14 9"></polyline>
              </svg>
            </button>
            <div class="nav-dropdown-menu">
              {CONTACT_SUBMENU.map((item) => (
                <a href={item.href}>{item.label}</a>
              ))}
            </div>
          </div>
        ) : (
          <a href={l.href}>{l.label}</a>
        )
      ))}
    </div>

    <!-- Right Side Actions -->
    <div class="site-nav-actions">
      <div class="site-nav-actions-vertical">
        <a href={ctaHref} class="site-cta">
          Request Inspection
        </a>
        <a href={`tel:${SITE.tel}`} class="site-phone-desktop">
          {SITE.phone}
        </a>
      </div>
    </div>
  </nav>

  <!-- Mobile Menu (hidden by default) -->
  <div class="mobile-menu" id="mobile-menu">
    <div class="mobile-menu-links">
      {NAV_LINKS_MOBILE.map((l) => (
        l.label === 'Contact' ? (
          <div class="mobile-nav-dropdown">
            <a href={l.href} class="mobile-nav-dropdown-link">{l.label}</a>
            <button class="mobile-nav-dropdown-trigger" aria-label="Open Contact submenu">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="6 9 10 13 14 9"></polyline>
              </svg>
            </button>
            <div class="mobile-nav-dropdown-menu">
              {CONTACT_SUBMENU.map((item) => (
                <a href={item.href}>{item.label}</a>
              ))}
            </div>
          </div>
        ) : (
          <a href={l.href}>{l.label}</a>
        )
      ))}
      <!-- Request Inspection CTA in Mobile Menu -->
      <a href={ctaHref} class="mobile-menu-cta">
        Request Inspection
      </a>
    </div>
    <div class="mobile-menu-footer">
      <a href={`tel:${SITE.tel}`} class="mobile-menu-phone">
        {SITE.phone}
      </a>
    </div>
  </div>
</header>

<script type="module" defer>
  // Mobile menu toggle - deferred for performance
  const menuBtn = document.querySelector('.mobile-menu-btn');
  const mobileMenu = document.getElementById('mobile-menu');

  if (menuBtn && mobileMenu) {
    menuBtn.addEventListener('click', () => {
      const isExpanded = menuBtn.getAttribute('aria-expanded') === 'true';
      const newValue = isExpanded ? 'false' : 'true';
      menuBtn.setAttribute('aria-expanded', newValue);
      mobileMenu.classList.toggle('active');
    });

    // Close menu when link is clicked
    const menuLinks = mobileMenu.querySelectorAll('a');
    menuLinks.forEach(link => {
      link.addEventListener('click', () => {
        menuBtn.setAttribute('aria-expanded', 'false');
        mobileMenu.classList.remove('active');
      });
    });
  }

  // Mobile dropdown toggle (button only, not the link)
  const mobileDropdownTriggers = document.querySelectorAll('.mobile-nav-dropdown-trigger');
  mobileDropdownTriggers.forEach(trigger => {
    trigger.addEventListener('click', (e) => {
      e.stopPropagation();
      const dropdown = trigger.closest('.mobile-nav-dropdown');
      dropdown.classList.toggle('active');
    });
  });

  // Desktop dropdown toggle (button only, not the link)
  const dropdownTriggers = document.querySelectorAll('.nav-dropdown-trigger');
  
  dropdownTriggers.forEach(trigger => {
    trigger.addEventListener('click', (e) => {
      e.stopPropagation();
      const dropdown = trigger.closest('.nav-dropdown');
      dropdown.classList.toggle('active');
    });
  });
  
  // Close dropdown when item clicked
  const dropdownItems = document.querySelectorAll('.nav-dropdown-menu a');
  dropdownItems.forEach(item => {
    item.addEventListener('click', () => {
      document.querySelectorAll('.nav-dropdown').forEach(d => d.classList.remove('active'));
    });
  });

  // Close desktop dropdown when clicking outside
  document.addEventListener('click', (e) => {
    if (!e.target.closest('.nav-dropdown')) {
      document.querySelectorAll('.nav-dropdown').forEach(d => d.classList.remove('active'));
    }
  });
</script>
